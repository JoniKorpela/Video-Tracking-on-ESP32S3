#ifndef TRACKER_H
#define TRACKER_H
#include "types.h"
#include <stdlib.h>
#include <math.h>
#include <stdbool.h>
#include "esp_camera.h"
#include <string.h>

#include "esp_timer.h"


#define KERNEL_RADIUS 3
#define FEATURE_ARR_SIZE 100


static const int8_t FAST_OFFSET_X[16] = {0, 1, 2, 3, 3, 3, 2, 1, 0, -1, -2, -3, -3, -3, -2, -1};
static const int8_t FAST_OFFSET_Y[16] = {-3, -3, -2, -1, 0, 1, 2, 3, 3, 3, 2, 1, 0, -1, -2, -3};

void tracker(camera_fb_t* picPtr, target_box* box, bool reset);

static const int8_t BRIEF_OFFSET[TRACK_BRIEF_SIZE][4] = {
{ 3, 8, 6, -17 }, 
{ 3, -12, -10, 0 }, 
{ 8, 4, -13, 0 }, 
{ -5, 5, 0, 8 }, 
{ 3, 2, -8, -6 }, 
{ 0, 5, 3, -6 }, 
{ -7, -1, -7, 8 }, 
{ -4, 5, 0, -17 }, 
{ 0, -2, 6, 8 }, 
{ -7, -2, -4, -2 }, 
{ 0, -2, 4, -8 }, 
{ 12, 9, 4, 1 }, 
{ -18, -1, -6, -13 }, 
{ -4, 2, -2, -8 }, 
{ 2, 20, 9, 1 }, 
{ -10, -3, 7, 1 }, 
{ 20, 6, 2, -7 }, 
{ 6, -5, 6, 17 }, 
{ -16, 1, -3, -5 }, 
{ 1, -12, -1, -4 }, 
{ -6, 0, -6, 1 }, 
{ -9, 0, -2, 14 }, 
{ 0, 0, 0, 3 }, 
{ -4, 5, 9, -2 }, 
{ 8, 3, 14, -6 }, 
{ -8, 7, -7, -3 }, 
{ -4, 8, -1, -13 }, 
{ -10, 8, 0, -16 }, 
{ 0, -12, 13, 0 }, 
{ -3, 0, -6, -8 }, 
{ 2, -9, -3, -2 }, 
{ -10, 1, -10, -9 }, 
{ -4, 2, -1, -5 }, 
{ 7, -16, 9, 11 }, 
{ 2, 12, 0, 4 }, 
{ -2, -7, -13, 6 }, 
{ 7, 2, 0, 4 }, 
{ 8, -3, 15, -22 }, 
{ -14, -1, 2, -10 }, 
{ -4, 7, 5, -12 }, 
{ 1, -15, -4, 1 }, 
{ -11, 8, 6, 0 }, 
{ 6, -6, -7, -5 }, 
{ 0, 4, 8, 0 }, 
{ 4, 8, -16, 8 }, 
{ 2, 0, 4, 8 }, 
{ -2, 10, -3, 8 }, 
{ -22, -1, -10, 5 }, 
{ 0, -13, -4, 6 }, 
{ 3, -6, 9, -7 }, 
{ 8, -1, 0, 0 }, 
{ 6, 11, 11, 6 }, 
{ 3, -8, -11, 4 }, 
{ -14, 17, 7, 20 }, 
{ -1, -6, -16, -5 }, 
{ 1, -1, 13, -13 }, 
{ 8, 0, -11, 5 }, 
{ 0, -7, 9, -6 }, 
{ 4, -10, 5, 1 }, 
{ 6, 14, 14, 0 }, 
{ -14, 6, 9, -8 }, 
{ -9, -12, -1, 0 }, 
{ 5, -8, 11, 5 }, 
{ -4, -3, -7, 6 }, 
{ 5, -3, 7, -1 }, 
{ 2, -1, -2, -1 }, 
{ -8, -3, -16, 1 }, 
{ -9, 0, 2, -8 }, 
{ -11, -10, 7, -13 }, 
{ 14, 0, -5, -4 }, 
{ 0, 5, 19, -15 }, 
{ -4, -2, 5, 9 }, 
{ 4, 2, 3, 11 }, 
{ -11, 8, -9, -22 }, 
{ -5, -10, 7, -11 }, 
{ -8, -3, -3, -11 }, 
{ 15, -11, 10, 8 }, 
{ 1, -20, -7, 8 }, 
{ 0, 8, 1, -1 }, 
{ -2, -6, 0, -1 }, 
{ 2, 6, 6, 3 }, 
{ 6, 19, -3, 9 }, 
{ 2, -5, -5, 2 }, 
{ -1, 0, 4, 14 }, 
{ 1, 0, -4, 17 }, 
{ 1, -16, 1, -1 }, 
{ 8, -5, -6, 5 }, 
{ -11, 6, 0, -10 }, 
{ 12, 4, -11, -5 }, 
{ 1, -9, -6, 10 }, 
{ 8, -11, 13, 8 }, 
{ -7, 0, 3, -4 }, 
{ -15, 1, 0, 8 }, 
{ -4, 12, 20, 8 }, 
{ 9, 0, -2, 0 }, 
{ -15, 10, -4, -7 }, 
{ 1, 5, -1, 1 }, 
{ -10, 17, 17, 0 }, 
{ 19, -10, 13, 17 }, 
{ 3, -6, 0, 15 }, 
{ 0, -12, 7, -4 }, 
{ 18, -9, 2, 0 }, 
{ -2, 4, -2, -1 }, 
{ -6, -2, 1, 4 }, 
{ -5, -1, -8, 0 }, 
{ -11, -4, -14, 2 }, 
{ -2, -3, 6, 1 }, 
{ 0, -2, 2, 5 }, 
{ 7, -3, -6, -2 }, 
{ -1, -6, 5, 9 }, 
{ -5, -12, 3, 0 }, 
{ 5, -11, 9, 12 }, 
{ -7, 3, -1, -8 }, 
{ 3, -3, -11, 1 }, 
{ -19, 4, 10, 2 }, 
{ 2, -13, 1, -3 }, 
{ 7, -6, 5, -20 }, 
{ -11, 0, 2, 0 }, 
{ -1, 1, -13, 21 }, 
{ -15, 17, -13, -10 }, 
{ -5, -15, -11, 10 }, 
{ 6, -3, -8, 6 }, 
{ 3, -3, 5, 2 }, 
{ 0, 2, -12, -5 }, 
{ -7, 6, 16, -12 }, 
{ -4, -8, -8, -1 }, 
{ 0, 4, 7, 2 }, 
{ -2, -8, 7, -10 }
};

#endif